{"ast":null,"code":"var _class;\nimport { Subject } from 'rxjs';\nimport { TokenModel } from '../models/account/token-model';\nimport * as i0 from \"@angular/core\";\nexport class Helpers {\n  constructor() {\n    this.authenticationChanged = new Subject();\n    this.tokenStorageName = 'token';\n  }\n  isAuthenticated() {\n    const localStorageToken = localStorage[this.tokenStorageName];\n    const isExistedToken = localStorageToken !== undefined && localStorageToken !== null && localStorageToken !== \"undefined\" && localStorageToken !== \"null\" && localStorageToken !== '';\n    if (isExistedToken) {\n      const tokenModel = this.getTokenFromStorage();\n      const today = new Date();\n      const isActive = tokenModel.expirationDate >= today;\n      if (!isActive) {\n        this.clearToken();\n        return false;\n      }\n      return true;\n    }\n    return false;\n  }\n  isAuthenticationChanged() {\n    return this.authenticationChanged.asObservable();\n  }\n  getToken() {\n    if (this.isAuthenticated()) return undefined;\n    const tokenModel = this.getTokenFromStorage();\n    return tokenModel.token;\n  }\n  getTokenFromStorage() {\n    return JSON.parse(localStorage[this.tokenStorageName]);\n  }\n  setToken(data) {\n    const today = new Date();\n    const tokenModel = new TokenModel();\n    tokenModel.token = data.token;\n    today.setDate(today.getDate() + data.expirationDays);\n    tokenModel.expirationDate = today;\n    console.log(`tokenModel.name #2: ${tokenModel.token}`);\n    console.log(`tokenModel.expirationDays #2: ${tokenModel.expirationDate}`);\n    this.setStorageToken(JSON.stringify(tokenModel));\n  }\n  failToken() {\n    this.clearToken();\n  }\n  logout() {\n    this.clearToken();\n  }\n  clearToken() {\n    this.setStorageToken(undefined);\n  }\n  setStorageToken(value) {\n    console.log(`in setStorageToken: ${value}`);\n    localStorage[this.tokenStorageName] = value;\n    this.authenticationChanged.next(this.isAuthenticated());\n  }\n}\n_class = Helpers;\n_class.ɵfac = function Helpers_Factory(t) {\n  return new (t || _class)();\n};\n_class.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: _class,\n  factory: _class.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"names":["Subject","TokenModel","Helpers","constructor","authenticationChanged","tokenStorageName","isAuthenticated","localStorageToken","localStorage","isExistedToken","undefined","tokenModel","getTokenFromStorage","today","Date","isActive","expirationDate","clearToken","isAuthenticationChanged","asObservable","getToken","token","JSON","parse","setToken","data","setDate","getDate","expirationDays","console","log","setStorageToken","stringify","failToken","logout","value","next","factory","ɵfac","providedIn"],"sources":["D:\\Kurulko\\My projects 2\\Notes\\angularapp\\src\\app\\helpers\\helpers.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { Subject } from 'rxjs';\r\nimport { TokenModel } from '../models/account/token-model';\r\nimport { TokenViewModel } from '../models/account/token-viewmodel';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class Helpers {\r\n    private authenticationChanged = new Subject<boolean>();\r\n    private readonly tokenStorageName: string = 'token';\r\n\r\n    public isAuthenticated() : boolean {\r\n        const localStorageToken = localStorage[this.tokenStorageName];\r\n        const isExistedToken =  localStorageToken !== undefined && localStorageToken !== null && localStorageToken !== \"undefined\" && localStorageToken !== \"null\" && localStorageToken !== ''; \r\n\r\n        if(isExistedToken){\r\n            const tokenModel = this.getTokenFromStorage()!;\r\n            const today = new Date();\r\n            const isActive = tokenModel.expirationDate >= today;\r\n\r\n            if(!isActive){\r\n                this.clearToken();\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        }\r\n        \r\n        return false; \r\n    }\r\n\r\n    public isAuthenticationChanged(): any {\r\n        return this.authenticationChanged.asObservable();\r\n    }\r\n\r\n    public getToken(): string|undefined {\r\n        if(this.isAuthenticated())\r\n            return undefined;\r\n        const tokenModel = this.getTokenFromStorage()!;\r\n        return tokenModel.token;\r\n    }\r\n\r\n    private getTokenFromStorage(): TokenModel|undefined {\r\n        return JSON.parse(localStorage[this.tokenStorageName]) as TokenModel|undefined;\r\n    }\r\n\r\n    public setToken(data: TokenViewModel): void {\r\n        const today = new Date();\r\n\r\n        const tokenModel:TokenModel = new TokenModel();\r\n        tokenModel.token = data.token;\r\n\r\n        today.setDate(today.getDate() + data.expirationDays);\r\n        tokenModel.expirationDate = today;\r\n\r\n        console.log(`tokenModel.name #2: ${tokenModel.token}`);\r\n        console.log(`tokenModel.expirationDays #2: ${tokenModel.expirationDate}`);\r\n\r\n        this.setStorageToken(JSON.stringify(tokenModel));\r\n    }\r\n\r\n    public failToken(): void {\r\n        this.clearToken();\r\n    }\r\n\r\n    public logout(): void {\r\n        this.clearToken();\r\n    }\r\n\r\n    private clearToken(): void{\r\n        this.setStorageToken(undefined);\r\n    }\r\n\r\n    private setStorageToken(value: any): void{\r\n        console.log(`in setStorageToken: ${value}`);\r\n        localStorage[this.tokenStorageName] = value;\r\n\r\n        this.authenticationChanged.next(this.isAuthenticated());\r\n    }\r\n}\r\n"],"mappings":";AACA,SAASA,OAAO,QAAQ,MAAM;AAC9B,SAASC,UAAU,QAAQ,+BAA+B;;AAM1D,OAAM,MAAOC,OAAO;EAHpBC,YAAA;IAIY,KAAAC,qBAAqB,GAAG,IAAIJ,OAAO,EAAW;IACrC,KAAAK,gBAAgB,GAAW,OAAO;;EAE5CC,eAAeA,CAAA;IAClB,MAAMC,iBAAiB,GAAGC,YAAY,CAAC,IAAI,CAACH,gBAAgB,CAAC;IAC7D,MAAMI,cAAc,GAAIF,iBAAiB,KAAKG,SAAS,IAAIH,iBAAiB,KAAK,IAAI,IAAIA,iBAAiB,KAAK,WAAW,IAAIA,iBAAiB,KAAK,MAAM,IAAIA,iBAAiB,KAAK,EAAE;IAEtL,IAAGE,cAAc,EAAC;MACd,MAAME,UAAU,GAAG,IAAI,CAACC,mBAAmB,EAAG;MAC9C,MAAMC,KAAK,GAAG,IAAIC,IAAI,EAAE;MACxB,MAAMC,QAAQ,GAAGJ,UAAU,CAACK,cAAc,IAAIH,KAAK;MAEnD,IAAG,CAACE,QAAQ,EAAC;QACT,IAAI,CAACE,UAAU,EAAE;QACjB,OAAO,KAAK;;MAGhB,OAAO,IAAI;;IAGf,OAAO,KAAK;EAChB;EAEOC,uBAAuBA,CAAA;IAC1B,OAAO,IAAI,CAACd,qBAAqB,CAACe,YAAY,EAAE;EACpD;EAEOC,QAAQA,CAAA;IACX,IAAG,IAAI,CAACd,eAAe,EAAE,EACrB,OAAOI,SAAS;IACpB,MAAMC,UAAU,GAAG,IAAI,CAACC,mBAAmB,EAAG;IAC9C,OAAOD,UAAU,CAACU,KAAK;EAC3B;EAEQT,mBAAmBA,CAAA;IACvB,OAAOU,IAAI,CAACC,KAAK,CAACf,YAAY,CAAC,IAAI,CAACH,gBAAgB,CAAC,CAAyB;EAClF;EAEOmB,QAAQA,CAACC,IAAoB;IAChC,MAAMZ,KAAK,GAAG,IAAIC,IAAI,EAAE;IAExB,MAAMH,UAAU,GAAc,IAAIV,UAAU,EAAE;IAC9CU,UAAU,CAACU,KAAK,GAAGI,IAAI,CAACJ,KAAK;IAE7BR,KAAK,CAACa,OAAO,CAACb,KAAK,CAACc,OAAO,EAAE,GAAGF,IAAI,CAACG,cAAc,CAAC;IACpDjB,UAAU,CAACK,cAAc,GAAGH,KAAK;IAEjCgB,OAAO,CAACC,GAAG,CAAC,uBAAuBnB,UAAU,CAACU,KAAK,EAAE,CAAC;IACtDQ,OAAO,CAACC,GAAG,CAAC,iCAAiCnB,UAAU,CAACK,cAAc,EAAE,CAAC;IAEzE,IAAI,CAACe,eAAe,CAACT,IAAI,CAACU,SAAS,CAACrB,UAAU,CAAC,CAAC;EACpD;EAEOsB,SAASA,CAAA;IACZ,IAAI,CAAChB,UAAU,EAAE;EACrB;EAEOiB,MAAMA,CAAA;IACT,IAAI,CAACjB,UAAU,EAAE;EACrB;EAEQA,UAAUA,CAAA;IACd,IAAI,CAACc,eAAe,CAACrB,SAAS,CAAC;EACnC;EAEQqB,eAAeA,CAACI,KAAU;IAC9BN,OAAO,CAACC,GAAG,CAAC,uBAAuBK,KAAK,EAAE,CAAC;IAC3C3B,YAAY,CAAC,IAAI,CAACH,gBAAgB,CAAC,GAAG8B,KAAK;IAE3C,IAAI,CAAC/B,qBAAqB,CAACgC,IAAI,CAAC,IAAI,CAAC9B,eAAe,EAAE,CAAC;EAC3D;;SAvESJ,OAAO;;mBAAPA,MAAO;AAAA;;SAAPA,MAAO;EAAAmC,OAAA,EAAPnC,MAAO,CAAAoC,IAAA;EAAAC,UAAA,EAFN;AAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}